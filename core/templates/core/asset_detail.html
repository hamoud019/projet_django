{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ asset.label }} - Détail</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{% static 'core/css/trading.css' %}">
</head>

<body>
    <div class="shell">
        <header class="topbar">
            <div class="brand">
                <div class="brand-title">{{ asset.label }} <span style="font-size:0.7em;color:var(--muted);">({{ asset.code }})</span></div>
                <div class="brand-sub">Détail de l’actif</div>
            </div>
            <nav class="nav">
                <a class="btn btn-ghost" href="/">Accueil</a>
                <a class="btn btn-ghost" href="/comparison/">Comparaison</a>
                <a class="btn btn-ghost" href="/prediction/">Prediction</a>
                <a class="btn btn-ghost" href="/admin/">Admin</a>
            </nav>
        </header>

        <section class="section card">
            <div class="section-title">
                <h2>{{ asset.label }} <span style="font-size:0.7em;color:var(--muted);">({{ asset.code }})</span></h2>
                <span class="subtle">Vue détaillée, graphique et historique</span>
            </div>
            <div class="stat-grid" style="margin-bottom:18px;">
                <div class="stat-card">
                    <span>Prix actuel</span>
                    <strong>{{ current_price|floatformat:2 }} MRU</strong>
                    <div class="subtle">{% if display_date %}{{ display_date }}{% else %}-{% endif %}</div>
                </div>
                <div class="stat-card">
                    <span>Variation 24h</span>
                    <strong style="color:{% if price_change >= 0 %}var(--good){% else %}var(--bad){% endif %};">
                        {{ price_change|floatformat:2 }} MRU
                    </strong>
                </div>
                <div class="stat-card">
                    <span>Min 7j</span>
                    <strong>{{ min_7d|floatformat:2 }} MRU</strong>
                </div>
                <div class="stat-card">
                    <span>Max 7j</span>
                    <strong>{{ max_7d|floatformat:2 }} MRU</strong>
                </div>
            </div>

            <div class="filters" style="margin-bottom:18px;">
                <form method="get" style="display:inline-flex;align-items:center;gap:10px;">
                    <label for="days" style="margin:0;">Afficher les derniers :</label>
                    <select id="days" name="days" onchange="this.form.submit()">
                        <option value="30" {% if days == 30 %}selected{% endif %}>30 jours</option>
                        <option value="90" {% if days == 90 %}selected{% endif %}>3 mois</option>
                        <option value="180" {% if days == 180 %}selected{% endif %}>6 mois</option>
                        <option value="365" {% if days == 365 %}selected{% endif %}>1 an</option>
                        <option value="730" {% if days == 730 %}selected{% endif %}>2 ans</option>
                    </select>
                </form>
            </div>

            <div class="chart-shell" style="margin-bottom:30px;">
                <canvas id="priceChart" height="100"></canvas>
            </div>

            {% if prices %}
            <div class="section-title" style="margin-top:18px;">
                <h3 style="margin:0;font-size:1.15rem;">Historique des prix</h3>
            </div>
            <table class="table table-compact">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Prix (MRU)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for price in prices %}
                    <tr>
                        <td>{{ price.date }}</td>
                        <td>{{ price.price_mru|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <div class="hero-actions" style="margin-top:24px;">
                <a class="btn btn-primary" href="/comparison/">Comparer</a>
                <a class="btn btn-secondary" href="/prediction/">Voir prédictions</a>
            </div>
        </section>
    </div>

    <script>
        const ctx = document.getElementById('priceChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ chart_dates|safe }},
                datasets: [{
                    label: '{{ asset.label }} (MRU)',
                    data: {{ chart_prices|safe }},
                    borderColor: '#22d3ee',
                    backgroundColor: 'rgba(34,211,238,0.08)',
                    borderWidth: 2,
                    tension: 0.35,
                    pointRadius: 2,
                    fill: true,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: { color: '#cbd5f5' }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#94a3b8' },
                        grid: { color: 'rgba(148, 163, 184, 0.15)' }
                    },
                    y: {
                        beginAtZero: false,
                        ticks: { color: '#94a3b8' },
                        grid: { color: 'rgba(148, 163, 184, 0.15)' }
                    }
                }
            }
        });
    </script>
</body>
</html>

