</div>

{% if category_type == 'devises' or category_type == 'all' %}
<section class="section card" style="margin-top: 40px; box-shadow: 0 0 32px 0 rgba(34,211,238,0.10); border: 1.5px solid var(--accent);">
    <div class="section-title" style="align-items: flex-end;">
        <div style="display:flex;align-items:center;gap:10px;">
            <span style="font-size:1.7em;">üìä</span>
            <h2 style="margin:0;">Variations des devises</h2>
        </div>
        <span class="subtle">Comparaison visuelle de toutes les devises</span>
    </div>
    <div class="chart-shell" style="height:340px;margin-bottom:18px;">
        <canvas id="currenciesChart"></canvas>
    </div>
</section>
{% endif %}

<script>
// --- Chart for all currencies (devises) ---
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('currenciesChart').getContext('2d');
    // Couleurs distinctes pour chaque devise (palette)
    const palette = [
        '#22d3ee', '#f59e0b', '#ef4444', '#10b981', '#6366f1', '#eab308', '#f472b6', '#0ea5e9', '#a3e635', '#f43f5e', '#8b5cf6', '#f97316', '#14b8a6', '#facc15', '#e11d48'
    ];
    const datasets = [];
    let colorIdx = 0;
    {% for code, data in devises.items %}
    datasets.push({
        label: '{{ code }}',
        data: {{ data.chart_prices|safe }},
        borderColor: palette[colorIdx % palette.length],
        backgroundColor: 'rgba(34,211,238,0.05)',
        borderWidth: 2,
        tension: 0.3,
        fill: false,
    });
    colorIdx++;
    {% endfor %}
    // Utiliser les dates du premier actif comme labels
    let labels = {{ currencies_chart_dates|safe }};
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: datasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: { color: '#cbd5f5' }
                }
            },
            scales: {
                x: {
                    ticks: { color: '#94a3b8' },
                    grid: { color: 'rgba(148, 163, 184, 0.15)' }
                },
                y: {
                    beginAtZero: false,
                    ticks: { color: '#94a3b8' },
                    grid: { color: 'rgba(148, 163, 184, 0.15)' }
                }
            }
        }
    });
});
</script>
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparaison - MRU Trading Desk</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{% static 'core/css/trading.css' %}">
</head>
<body class="dark-mode">
    <div class="shell">
        <header class="topbar">
            <div class="brand">
                <div class="brand-title">Comparaison</div>
                <div class="brand-sub">Vue rapide par categorie</div>
            </div>
            <nav class="nav styled-buttons">
                <a class="btn btn-ghost" href="/">Accueil</a>
                <a class="btn btn-ghost active" href="/comparison/">Comparaison</a>
                <a class="btn btn-ghost" href="/prediction/">Prediction</a>
                <a class="btn btn-ghost" href="/admin/">Admin</a>
            </nav>
        </header>

            <div class="section-title" style="align-items: flex-end;">
                <div style="display:flex;align-items:center;gap:10px;">
                    <span style="font-size:1.7em;">üîÅ</span>
                    <h2 style="margin:0;">Convertisseur d'actifs</h2>
                </div>
                <span class="subtle">Convertissez un montant d'un actif √† l'autre</span>
            </div>
            <form id="convert-form" class="convert-form" onsubmit="return false;" style="display:flex;gap:18px;align-items:end;flex-wrap:wrap;background:rgba(34,211,238,0.04);padding:18px 18px 10px 18px;border-radius:14px;box-shadow:0 2px 12px rgba(34,211,238,0.06);">
                <div style="min-width:120px;">
                    <label for="amount">Montant</label>
                    <input type="number" id="amount" name="amount" min="0" step="any" value="1" style="width:100%;font-size:1.1em;padding:8px 10px;border-radius:8px;border:1.5px solid var(--border);background:rgba(10,16,30,0.7);color:var(--text);">
                </div>
                <div style="min-width:180px;">
                    <label for="from">De</label>
                    <select id="from" name="from" style="width:100%;font-size:1.1em;padding:8px 10px;border-radius:8px;border:1.5px solid var(--border);background:rgba(10,16,30,0.7);color:var(--text);">
                        {% for code, data in devises.items %}
                        <option value="{{ code }}" data-price="{{ data.current_price }}">{{ code }} - {{ data.asset.label }}</option>
                        {% endfor %}
                        {% for code, data in metaux.items %}
                        <option value="{{ code }}" data-price="{{ data.current_price }}">{{ code }} - {{ data.asset.label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div style="min-width:180px;">
                    <label for="to">Vers</label>
                    <select id="to" name="to" style="width:100%;font-size:1.1em;padding:8px 10px;border-radius:8px;border:1.5px solid var(--border);background:rgba(10,16,30,0.7);color:var(--text);">
                        {% for code, data in devises.items %}
                        <option value="{{ code }}" data-price="{{ data.current_price }}">{{ code }} - {{ data.asset.label }}</option>
                        {% endfor %}
                        {% for code, data in metaux.items %}
                        <option value="{{ code }}" data-price="{{ data.current_price }}">{{ code }} - {{ data.asset.label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button class="btn btn-primary" style="font-size:1.1em;padding:12px 28px;min-width:120px;" onclick="convertAssets()">Convertir</button>
                <div id="convert-result" style="display:flex;align-items:center;gap:10px;font-weight:700;font-size:1.18em;margin-left:18px;min-width:220px;transition:background 0.2s,border 0.2s;">
                </div>
            </form>
        </section>
            </div>
            <script>
            function convertAssets() {
                const amount = parseFloat(document.getElementById('amount').value);
                const from = document.getElementById('from').value;
                const to = document.getElementById('to').value;
                const resultDiv = document.getElementById('convert-result');
                resultDiv.innerHTML = '';
                resultDiv.style.background = '';
                resultDiv.style.border = '';
                if (!amount || from === to) {
                    return;
                }
                const fromOption = document.querySelector(`#from option[value='${from}']`);
                const toOption = document.querySelector(`#to option[value='${to}']`);
                let fromPrice = 1, toPrice = 1;
                try {
                    fromPrice = parseFloat(fromOption.getAttribute('data-price'));
                    toPrice = parseFloat(toOption.getAttribute('data-price'));
                } catch {}
                if (!fromPrice || !toPrice) {
                    resultDiv.innerHTML = '<span style="background:#ef4444;color:#fff;padding:6px 18px;border-radius:999px;font-size:1em;">Prix non disponible</span>';
                    resultDiv.style.background = 'none';
                    resultDiv.style.border = 'none';
                    return;
                }
                const result = amount * fromPrice / toPrice;
                const formatted = parseFloat(result.toFixed(2)).toString();
                resultDiv.innerHTML = `<span style="background:rgba(12,18,32,0.98);color:#e5e7eb;padding:10px 26px;border-radius:14px;box-shadow:0 2px 12px rgba(34,211,238,0.10);display:inline-flex;align-items:center;gap:10px;animation:popResult 0.25s;font-size:1.13em;letter-spacing:0.01em;">
                    <span style='font-size:1.25em;'>üí±</span> <span>${amount}</span> <span style='color:#22d3ee;font-weight:700;'>${from}</span> <span style='font-size:1.1em;'>=</span> <span style='color:#f59e0b;font-weight:700;'>${formatted}</span> <span style='color:#22d3ee;font-weight:700;'>${to}</span>
                </span>`;
                resultDiv.style.background = 'none';
                resultDiv.style.border = 'none';
            }

            // Animation CSS
            const style = document.createElement('style');
            style.innerHTML = `@keyframes popResult {0%{transform:scale(0.8);opacity:0.2;}100%{transform:scale(1);opacity:1;}}`;
            document.head.appendChild(style);
            </script>
            <div class="section-title">
                <h2>Filtre</h2>
                <span class="subtle">Selection par cat√©gorie</span>
            </div>
            <div class="hero-actions">
                <a class="btn btn-ghost {% if category_type == 'all' %}active{% endif %}" href="?type=all">Tous</a>
                <a class="btn btn-ghost {% if category_type == 'devises' %}active{% endif %}" href="?type=devises">Devises</a>
                <a class="btn btn-ghost {% if category_type == 'metaux' %}active{% endif %}" href="?type=metaux">Matieres premieres</a>
            </div>
        </section>

        {% if devises %}
        <section class="section card">
            <div class="section-title">
                <h2>Devises</h2>
                <span class="subtle">Graphiques miniatures et stats</span>
            </div>
            <div class="stat-grid">
                {% for code, data in devises.items %}
                <div class="stat-card">
                    <span>{{ data.asset.code }} - {{ data.asset.label }}</span>
                    <strong>{{ data.current_price|floatformat:2 }} MRU</strong>
                    <div class="subtle">Min {{ data.min|floatformat:2 }} | Max {{ data.max|floatformat:2 }}</div>
                    <div class="chart-shell small-chart">
                        <canvas id="chart-{{ code }}"></canvas>
                    </div>
                    <a class="btn btn-primary" style="margin-top:10px;display:inline-flex;align-items:center;gap:7px;font-size:1.04em;padding:8px 20px;" href="/asset/{{ code }}/">
                        <span style="font-size:1.1em;">üîé</span> Voir d√©tails
                    </a>
                </div>
                <script>
                    const ctx{{ code }} = document.getElementById('chart-{{ code }}').getContext('2d');
                    new Chart(ctx{{ code }}, {
                        type: 'line',
                        data: {
                            labels: {{ data.chart_dates|safe }},
                            datasets: [{
                                data: {{ data.chart_prices|safe }},
                                borderColor: '#22d3ee',
                                backgroundColor: 'rgba(34, 211, 238, 0.15)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.35
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { display: false },
                                y: { display: false }
                            }
                        }
                    });
                </script>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        {% if metaux %}
        <section class="section card">
            <div class="section-title">
                <h2>Matieres premieres</h2>
            </div>
            <div class="stat-grid">
                {% for code, data in metaux.items %}
                <div class="stat-card">
                    <span>{{ data.asset.code }} - {{ data.asset.label }}</span>
                    <strong>{{ data.current_price|floatformat:2 }} MRU</strong>
                    <div class="subtle">Min {{ data.min|floatformat:2 }} | Max {{ data.max|floatformat:2 }}</div>
                    <div class="chart-shell small-chart">
                        <canvas id="chart-{{ code }}"></canvas>
                    </div>
                    <a class="btn btn-primary" style="margin-top:10px;display:inline-flex;align-items:center;gap:7px;font-size:1.04em;padding:8px 20px;" href="/asset/{{ code }}/">
                        <span style="font-size:1.1em;">üîé</span> Voir d√©tails
                    </a>
                </div>
                <script>
                    const ctx{{ code }} = document.getElementById('chart-{{ code }}').getContext('2d');
                    new Chart(ctx{{ code }}, {
                        type: 'line',
                        data: {
                            labels: {{ data.chart_dates|safe }},
                            datasets: [{
                                data: {{ data.chart_prices|safe }},
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.15)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.35
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { display: false },
                                y: { display: false }
                            }
                        }
                    });
                </script>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        {% if not comparison %}
        <section class="section card">
            <div class="notice">Aucune donnee disponible</div>
        </section>
        {% endif %}
    </div>
</body>
</html>
